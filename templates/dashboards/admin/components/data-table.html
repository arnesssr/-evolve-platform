<!-- Data Table Component -->
<!-- Usage: {% include 'dashboards/admin/components/data-table.html' with table_id="usersTable" columns=columns data=users %} -->

<div class="card data-table-card">
    <div class="card-header bg-white border-bottom">
        <div class="d-flex justify-content-between align-items-center flex-wrap">
            <h5 class="mb-0">{{ title|default:"Data Table" }}</h5>
            <div class="d-flex gap-2 align-items-center">
                {% if show_search %}
                <div class="search-box">
                    <input type="text" class="form-control form-control-sm" id="{{ table_id }}_search" placeholder="Search...">
                </div>
                {% endif %}
                {% if actions %}
                <div class="dropdown">
                    <button class="btn btn-sm btn-outline-secondary dropdown-toggle" type="button" data-bs-toggle="dropdown">
                        Actions
                    </button>
                    <ul class="dropdown-menu dropdown-menu-end">
                        {% for action in actions %}
                        <li><a class="dropdown-item" href="#" onclick="{{ action.onclick }}">
                            <i class="fas {{ action.icon }} me-2"></i>{{ action.label }}
                        </a></li>
                        {% endfor %}
                    </ul>
                </div>
                {% endif %}
                {% if show_export %}
                <button class="btn btn-sm btn-outline-primary" onclick="exportTable('{{ table_id }}')">
                    <i class="fas fa-download me-1"></i>Export
                </button>
                {% endif %}
            </div>
        </div>
    </div>
    <div class="card-body p-0">
        <div class="table-responsive">
            <table class="table table-hover mb-0" id="{{ table_id }}">
                <thead class="table-light">
                    <tr>
                        {% if show_checkbox %}
                        <th class="text-center" style="width: 40px;">
                            <input type="checkbox" class="form-check-input" id="selectAll" onchange="toggleAllCheckboxes(this)">
                        </th>
                        {% endif %}
                        {% for column in columns %}
                        <th class="{{ column.class }}" {% if column.width %}style="width: {{ column.width }};"{% endif %}>
                            {{ column.label }}
                            {% if column.sortable %}
                            <i class="fas fa-sort ms-1 text-muted"></i>
                            {% endif %}
                        </th>
                        {% endfor %}
                        {% if show_actions %}
                        <th class="text-center" style="width: 100px;">Actions</th>
                        {% endif %}
                    </tr>
                </thead>
                <tbody>
                    {% if data %}
                        {% for row in data %}
                        <tr>
                            {% if show_checkbox %}
                            <td class="text-center">
                                <input type="checkbox" class="form-check-input row-checkbox" value="{{ row.id }}">
                            </td>
                            {% endif %}
                            {% for column in columns %}
                            <td class="{{ column.class }}">
                                {% if column.template %}
                                    {% include column.template with item=row %}
                                {% else %}
                                    {{ row|lookup:column.field }}
                                {% endif %}
                            </td>
                            {% endfor %}
                            {% if show_actions %}
                            <td class="text-center">
                                <div class="dropdown">
                                    <button class="btn btn-sm btn-light" type="button" data-bs-toggle="dropdown">
                                        <i class="fas fa-ellipsis-v"></i>
                                    </button>
                                    <ul class="dropdown-menu dropdown-menu-end">
                                        <li><a class="dropdown-item" href="{% url row_detail_url row.id %}">
                                            <i class="fas fa-eye me-2"></i>View
                                        </a></li>
                                        <li><a class="dropdown-item" href="{% url row_edit_url row.id %}">
                                            <i class="fas fa-edit me-2"></i>Edit
                                        </a></li>
                                        <li><hr class="dropdown-divider"></li>
                                        <li><a class="dropdown-item text-danger" href="#" onclick="confirmDelete({{ row.id }})">
                                            <i class="fas fa-trash me-2"></i>Delete
                                        </a></li>
                                    </ul>
                                </div>
                            </td>
                            {% endif %}
                        </tr>
                        {% endfor %}
                    {% else %}
                        <tr>
                            <td colspan="{% if show_checkbox %}{{ columns|length|add:2 }}{% else %}{{ columns|length|add:1 }}{% endif %}" class="text-center py-5">
                                <i class="fas fa-database fa-3x text-muted mb-3"></i>
                                <p class="text-muted mb-0">No data available</p>
                            </td>
                        </tr>
                    {% endif %}
                </tbody>
            </table>
        </div>
    </div>
    {% if show_pagination and data %}
    <div class="card-footer bg-light">
        <div class="d-flex justify-content-between align-items-center">
            <div class="text-muted">
                Showing <span id="showing_start">1</span> to <span id="showing_end">{{ data|length }}</span> 
                of <span id="total_entries">{{ total_count|default:data|length }}</span> entries
            </div>
            <nav>
                <ul class="pagination pagination-sm mb-0">
                    <li class="page-item disabled">
                        <a class="page-link" href="#" tabindex="-1">Previous</a>
                    </li>
                    <li class="page-item active"><a class="page-link" href="#">1</a></li>
                    <li class="page-item"><a class="page-link" href="#">2</a></li>
                    <li class="page-item"><a class="page-link" href="#">3</a></li>
                    <li class="page-item">
                        <a class="page-link" href="#">Next</a>
                    </li>
                </ul>
            </nav>
        </div>
    </div>
    {% endif %}
</div>

<script>
// Initialize DataTable if using DataTables library
document.addEventListener('DOMContentLoaded', function() {
    // Basic search functionality
    const searchInput = document.getElementById('{{ table_id }}_search');
    if (searchInput) {
        searchInput.addEventListener('keyup', function() {
            const searchTerm = this.value.toLowerCase();
            const tableRows = document.querySelectorAll('#{{ table_id }} tbody tr');
            
            tableRows.forEach(row => {
                const text = row.textContent.toLowerCase();
                row.style.display = text.includes(searchTerm) ? '' : 'none';
            });
        });
    }
});

function toggleAllCheckboxes(source) {
    const checkboxes = document.querySelectorAll('.row-checkbox');
    checkboxes.forEach(checkbox => {
        checkbox.checked = source.checked;
    });
}

function exportTable(tableId) {
    // Implement export functionality
    console.log('Exporting table:', tableId);
}

function confirmDelete(id) {
    if (confirm('Are you sure you want to delete this item?')) {
        // Implement delete functionality
        console.log('Deleting item:', id);
    }
}
</script>
